ˆ 
JC:\Users\Dima\dmwebplatform_git\DmWebPlatform.Notifications.API\Program.cs
var		 
builder		 
=		 
WebApplication		 
.		 
CreateBuilder		 *
(		* +
args		+ /
)		/ 0
;		0 1
var 
appSettings 
= 
new 
AppSettings !
(! "
)" #
;# $
builder 
. 
Configuration 
. 

GetSection  
(  !
$str! 4
)4 5
.5 6
Bind6 :
(: ;
appSettings; F
,F G
optionsH O
=>P R
optionsS Z
.Z [#
BindNonPublicProperties[ r
=s t
trueu y
)y z
;z {
builder 
. 
Services 
. 
AddAutoMapper 
( 
typeof %
(% &
MappingProfile& 4
)4 5
)5 6
;6 7
builder 
. 
Services 
. 
AddDatabase 
( 
builder $
.$ %
Configuration% 2
)2 3
;3 4
builder 
. 
Services 
. 
	AddScoped 
<  
INotificationService /
,/ 0
NotificationService1 D
>D E
(E F
)F G
;G H
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddSwaggerGen 
( 
)  
;  !
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
using 
( 
var 

scope 
= 
app 
. 
Services 
.  
CreateScope  +
(+ ,
), -
)- .
{ 
var   
services   
=   
scope   
.   
ServiceProvider   (
;  ( )
try!! 
{"" 
var## 
	dbContext## 
=## 
services##  
.##  !
GetRequiredService##! 3
<##3 4!
NotificationDbContext##4 I
>##I J
(##J K
)##K L
;##L M
	dbContext$$ 
.$$ 
Database$$ 
.$$ 
Migrate$$ "
($$" #
)$$# $
;$$$ %
Log%% 
.%% 
Information%% 
(%% 
$str%% :
)%%: ;
;%%; <
}&& 
catch'' 	
(''
 
	Exception'' 
ex'' 
)'' 
{(( 
Log)) 
.)) 
Fatal)) 
()) 
ex)) 
,)) 
$str)) G
)))G H
;))H I
throw** 
;** 
}++ 
},, 
if00 
(00 
app00 
.00 
Environment00 
.00 
IsDevelopment00 !
(00! "
)00" #
)00# $
{11 
app22 
.22 

UseSwagger22 
(22 
)22 
;22 
app33 
.33 
UseSwaggerUI33 
(33 
)33 
;33 
}44 
app66 
.66 
UseHttpsRedirection66 
(66 
)66 
;66 
app88 
.88 
UseAuthorization88 
(88 
)88 
;88 
app:: 
.:: 
MapControllers:: 
(:: 
):: 
;:: 
app<< 
.<< 
Run<< 
(<< 
)<< 	
;<<	 
º
UC:\Users\Dima\dmwebplatform_git\DmWebPlatform.Notifications.API\Models\AppSettings.cs
	namespace 	
DmWebPlatform
 
. 
Notifications %
.% &
API& )
.) *
Models* 0
{ 
public 

class 
AppSettings 
{ 
public 
static 
string 
DefaultConnection .
{/ 0
get1 4
;4 5
private6 =
set> A
;A B
}C D
} 
} ï
iC:\Users\Dima\dmwebplatform_git\DmWebPlatform.Notifications.API\Extensions\ServiceCollectionExtensions.cs
	namespace 	
DmWebPlatform
 
. 
API 
. 

Extensions &
{ 
public		 

static		 
class		 '
ServiceCollectionExtensions		 3
{

 
public 
static 
IServiceCollection (
AddDatabase) 4
(4 5
this5 9
IServiceCollection: L
servicesM U
,U V
IConfigurationW e
configurationf s
)s t
{ 	
services 
. 
AddDbContext !
<! "!
NotificationDbContext" 7
>7 8
(8 9
options9 @
=>A C
{ 
options 
. 
UseSqlServer $
($ %
AppSettings% 0
.0 1
DefaultConnection1 B
,B C

sqlOptions 
=> !

sqlOptions" ,
., -
CommandTimeout- ;
(; <
$num< ?
)? @
)@ A
;A B
options 
. !
UseLazyLoadingProxies -
(- .
). /
;/ 0
} 
) 
; 
services 
. 
	AddScoped 
< 
Func #
<# $!
NotificationDbContext$ 9
>9 :
>: ;
(; <
(< =
provider= E
)E F
=>G I
(J K
)K L
=>M O
providerP X
.X Y

GetServiceY c
<c d!
NotificationDbContextd y
>y z
(z {
){ |
)| }
;} ~
services 
. 
	AddScoped 
< 
	DbFactory (
>( )
() *
)* +
;+ ,
services 
. 
	AddScoped 
< 
IUnitOfWork *
,* +

UnitOfWork, 6
>6 7
(7 8
)8 9
;9 :
return   
services   
;   
}!! 	
}"" 
}## ·-
eC:\Users\Dima\dmwebplatform_git\DmWebPlatform.Notifications.API\Controllers\NotificationController.cs
	namespace 	
DmWebPlatform
 
. 
Notifications %
.% &
API& )
.) *
Controllers* 5
{ 
[ 
ApiController 
] 
[		 
Route		 

(		
 
$str		 
)		 
]		 
public

 

class

 "
NotificationController

 '
:

( )
ControllerBase

* 8
{ 
private 
readonly  
INotificationService - 
_notificationService. B
;B C
public "
NotificationController %
(% & 
INotificationService& :
notificationService; N
)N O
{ 	 
_notificationService  
=! "
notificationService# 6
;6 7
} 	
[ 	
HttpPost	 
( 
$str 
) 
] 
[ 	
	Authorize	 
( 
Roles 
= 
$str !
)! "
]" #
[ 	 
ProducesResponseType	 
( 
StatusCodes )
.) *
Status200OK* 5
)5 6
]6 7
[ 	 
ProducesResponseType	 
( 
StatusCodes )
.) *
Status400BadRequest* =
)= >
]> ?
public 
async 
Task 
< 
ActionResult &
>& '
	Subscribe( 1
(1 2
[2 3
FromBody3 ;
]; <
NotificationDto= L
dtoM P
)P Q
{ 	
if 
( 
dto 
== 
null 
|| 
string %
.% &
IsNullOrEmpty& 3
(3 4
dto4 7
.7 8
Email8 =
)= >
)> ?
{ 
return 

BadRequest !
(! "
$str" >
)> ?
;? @
} 
await  
_notificationService &
.& '
AddSubscription' 6
(6 7
dto7 :
): ;
;; <
return   
Ok   
(   
$str   0
)  0 1
;  1 2
}!! 	
[$$ 	
HttpPost$$	 
($$ 
$str$$ 
)$$  
]$$  !
[%% 	 
ProducesResponseType%%	 
(%% 
StatusCodes%% )
.%%) *
Status200OK%%* 5
)%%5 6
]%%6 7
[&& 	 
ProducesResponseType&&	 
(&& 
StatusCodes&& )
.&&) *
Status400BadRequest&&* =
)&&= >
]&&> ?
public'' 
async'' 
Task'' 
<'' 
ActionResult'' &
>''& '
Unsubscribe''( 3
(''3 4
[''4 5
FromBody''5 =
]''= >
NotificationDto''? N
dto''O R
)''R S
{(( 	
if)) 
()) 
dto)) 
==)) 
null)) 
||)) 
string)) %
.))% &
IsNullOrEmpty))& 3
())3 4
dto))4 7
.))7 8
Email))8 =
)))= >
)))> ?
{** 
return++ 

BadRequest++ !
(++! "
$str++" @
)++@ A
;++A B
},, 
await..  
_notificationService.. &
...& '
RemoveSubscription..' 9
(..9 :
dto..: =
...= >
Id..> @
)..@ A
;..A B
return// 
Ok// 
(// 
$str// 2
)//2 3
;//3 4
}00 	
[33 	
HttpGet33	 
(33 
$str33 
)33 
]33 
[44 	
	Authorize44	 
(44 
Roles44 
=44 
$str44 !
)44! "
]44" #
[55 	
	Authorize55	 
(55 
Roles55 
=55 
$str55 '
)55' (
]55( )
[66 	 
ProducesResponseType66	 
(66 
typeof66 $
(66$ %
IEnumerable66% 0
<660 1
NotificationDto661 @
>66@ A
)66A B
,66B C
StatusCodes66D O
.66O P
Status200OK66P [
)66[ \
]66\ ]
[77 	 
ProducesResponseType77	 
(77 
StatusCodes77 )
.77) *
Status404NotFound77* ;
)77; <
]77< =
public88 
async88 
Task88 
<88 
ActionResult88 &
<88& '
IEnumerable88' 2
<882 3
NotificationDto883 B
>88B C
>88C D
>88D E
GetNotifications88F V
(88V W
int88W Z
eventId88[ b
)88b c
{99 	
var:: 
notifications:: 
=:: 
await::  % 
_notificationService::& :
.::: ;)
GetNotificationsForEventAsync::; X
(::X Y
eventId::Y `
)::` a
;::a b
if<< 
(<< 
notifications<< 
==<<  
null<<! %
||<<& (
!<<) *
notifications<<* 7
.<<7 8
Any<<8 ;
(<<; <
)<<< =
)<<= >
{== 
return>> 
NotFound>> 
(>>  
$str>>  Q
)>>Q R
;>>R S
}?? 
returnAA 
OkAA 
(AA 
notificationsAA #
)AA# $
;AA$ %
}BB 	
}CC 
}DD 